# å‰è¨€
>æ–‡æœ¬å·²æ”¶å½•è‡³æˆ‘çš„GitHubä»“åº“ï¼Œæ¬¢è¿Starï¼šhttps://github.com/bin392328206/six-finger                             
> **ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨**   
>æˆ‘çŸ¥é“å¾ˆå¤šäººä¸ç©**qq**äº†,ä½†æ˜¯æ€€æ—§ä¸€ä¸‹,æ¬¢è¿åŠ å…¥å…­è„‰ç¥å‰‘Javaèœé¸Ÿå­¦ä¹ ç¾¤ï¼Œç¾¤èŠå·ç ï¼š**549684836** é¼“åŠ±å¤§å®¶åœ¨æŠ€æœ¯çš„è·¯ä¸Šå†™åšå®¢
## çµ®å¨ 
åŸç†çš„ä¸œè¥¿ï¼Œå‰é¢åŸºæœ¬è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥ï¼Œè®²è®²ç”¨æ³•å§ï¼Œè®²è®²Javaå®ç°çš„å¹¶å‘çš„æ¡†æ¶  
- [ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå¹¶å‘ç³»åˆ—ä¹‹å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜](https://juejin.im/post/5dfb1ca26fb9a0160b63827f)  
- [ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå¹¶å‘ç³»åˆ—ä¹‹Javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†](https://juejin.im/post/5dfb3a27e51d4558181d35b0)    
- [ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå¹¶å‘ç³»åˆ—ä¹‹Javaå†…å­˜æ¨¡å‹](https://juejin.im/post/5dfc3dadf265da339b5001dd)  
- [ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå¹¶å‘ç³»åˆ—ä¹‹Javaå¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰](https://juejin.im/post/5dfc9106518825126e63a711) 
- [ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå¹¶å‘ç³»åˆ—ä¹‹Javaå¤šçº¿ç¨‹ï¼ˆäºŒï¼‰](https://juejin.im/post/5dfeeed6e51d45582248e4a5)   
- [ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå¹¶å‘ç³»åˆ—ä¹‹Javaä¸­çš„é”çš„ä½¿ç”¨å’Œå®ç°ä»‹ç»ï¼ˆä¸€ï¼‰](https://juejin.im/post/5e002416e51d45583b43939d) 
 
- [ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå¹¶å‘ç³»åˆ—ä¹‹Javaä¸­çš„é”çš„ä½¿ç”¨å’Œå®ç°ä»‹ç»ï¼ˆäºŒï¼‰](https://juejin.im/post/5e0037a651882512670ee0b5)

## ConcurrentHashMap
è¿™ä¸ªå‘¢ï¼Œæˆ‘åœ¨å‰é¢é›†åˆå®¹å™¨æœ‰è®²åˆ°ï¼Œé“¾æ¥åœ¨ä¸‹é¢   
[ğŸ”¥å²ä¸Šæœ€å…¨çš„Javaå®¹å™¨é›†åˆä¹‹ConcurrentHashMapï¼ˆæºç è§£è¯»ï¼‰](https://juejin.im/post/5dee17adf265da33942a7798)  
å¤§å®¶æœ‰å…´è¶£çš„å»çœ‹çœ‹

## ConcureentLinkedQueue
åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ã€‚   
å¦‚æœè¦å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—æœ‰ä¸¤ç§æ–¹å¼ï¼š
- ä½¿ç”¨é˜»å¡ç®—æ³•ï¼šä½¿ç”¨é˜»å¡ç®—æ³•çš„é˜Ÿåˆ—å¯ä»¥ç”¨ä¸€ä¸ªé”ï¼ˆå…¥é˜Ÿå’Œå‡ºé˜Ÿç”¨åŒä¸€æŠŠé”ï¼‰æˆ–ä¸¤ä¸ªé”ï¼ˆå…¥é˜Ÿå’Œå‡ºé˜Ÿç”¨ä¸åŒçš„é”ï¼‰ç­‰æ–¹å¼æ¥å®ç°ã€‚
- ä½¿ç”¨éé˜»å¡ç®—æ³•ï¼šéé˜»å¡çš„å®ç°æ–¹å¼åˆ™å¯ä»¥ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥å®ç°ã€‚

ConcurrentLinkedQueueæ˜¯ä¸€ä¸ªåŸºäºé“¾æ¥èŠ‚ç‚¹çš„æ— ç•Œçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼Œå®ƒé‡‡ç”¨FIFOçš„è§„åˆ™å¯¹èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå®ƒä¼šæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼›å½“æˆ‘ä»¬è·å–ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šè¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ã€‚å®ƒé‡‡ç”¨äº†â€œwait-freeâ€ç®—æ³•ï¼ˆå³CASç®—æ³•ï¼‰æ¥å®ç°ï¼Œè¯¥ç®—æ³•åœ¨Michael&Scottç®—æ³•ä¸Šè¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ã€‚


![](https://user-gold-cdn.xitu.io/2019/12/23/16f317c1650e59db?w=682&h=338&f=png&s=99767)
ConcurrentLinkedQueueç”±headèŠ‚ç‚¹å’ŒtailèŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹Nodeç”±èŠ‚ç‚¹å…ƒç´ itemå’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹nextçš„å¼•ç”¨ç»„æˆï¼ŒèŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´å°±æ˜¯é€šè¿‡è¿™ä¸ªnextå…³è”èµ·æ¥ï¼Œä»è€Œç»„æˆä¸€å¼ é“¾è¡¨ç»“æ„çš„é˜Ÿåˆ—ã€‚


### å…¥é˜Ÿåˆ—
å…¥é˜Ÿåˆ—å°±æ˜¯å°†å…¥é˜ŸèŠ‚ç‚¹æ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚

![](https://user-gold-cdn.xitu.io/2019/12/23/16f317ff005fa280?w=702&h=395&f=png&s=106030)
- æ·»åŠ å…ƒç´ 1ï¼šé˜Ÿåˆ—æ›´æ–°headèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ºå…ƒç´ 1èŠ‚ç‚¹ã€‚åˆå› ä¸ºtailèŠ‚ç‚¹é»˜è®¤æƒ…å†µä¸‹ç­‰äºheadèŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒä»¬çš„nextèŠ‚ç‚¹éƒ½æŒ‡å‘å…ƒç´ 1èŠ‚ç‚¹ã€‚
- æ·»åŠ å…ƒç´ 2ï¼šé˜Ÿåˆ—é¦–å…ˆè®¾ç½®å…ƒç´ 1èŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ºå…ƒç´ 2èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–°tailèŠ‚ç‚¹æŒ‡å‘å…ƒç´ 2èŠ‚ç‚¹ã€‚
- æ·»åŠ å…ƒç´ 3ï¼šè®¾ç½®tailèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ºå…ƒç´ 3èŠ‚ç‚¹ã€‚
- æ·»åŠ å…ƒç´ 4ï¼šè®¾ç½®å…ƒç´ 3çš„nextèŠ‚ç‚¹ä¸ºå…ƒç´ 4èŠ‚ç‚¹ï¼Œç„¶åå°†tailèŠ‚ç‚¹æŒ‡å‘å…ƒç´ 4èŠ‚ç‚¹ã€‚

é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å‘ç°ï¼Œå…¥é˜Ÿä¸»è¦åšä¸¤ä»¶äº‹æƒ…ï¼š

- å°†å…¥é˜ŸèŠ‚ç‚¹è®¾ç½®æˆå½“å‰é˜Ÿåˆ—å°¾èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
- æ›´æ–°tailèŠ‚ç‚¹ï¼Œå¦‚æœtailèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°†å…¥é˜ŸèŠ‚ç‚¹è®¾ç½®æˆtailèŠ‚ç‚¹ï¼Œå¦‚æœtailèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™å°†å…¥é˜ŸèŠ‚ç‚¹è®¾ç½®æˆtailçš„nextèŠ‚ç‚¹ï¼Œæ‰€ä»¥tailèŠ‚ç‚¹ä¸æ€»æ˜¯å°¾èŠ‚ç‚¹
- ä»¥ä¸‹æ˜¯å…¥é˜Ÿåˆ—çš„æºç ï¼š

```
public boolean add(E e) {
    return offer(e);
}
public boolean offer(E e) {
    final Node<E> newNode = newNode(Objects.requireNonNull(e));
    for (Node<E> t = tail, p = t;;) {
        Node<E> q = p.next;
        if (q == null) {
            // p is last node
            if (casNext(p, null, newNode)) {
                if (p != t) // hop two nodes at a time
                    casTail(t, newNode);  // Failure is OK.
                return true;
            }
        }
        else if (p == q)
            p = (t != (t = tail)) ? t : head;
        else
            // Check for tail updates after two hops.
            p = (p != t && t != (t = tail)) ? t : q;
    }
}
```
- æ„å»ºäº†ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹newNode
- å¦‚æœtailèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™é€šè¿‡CASå°†newNodeè®¾ç½®ä¸ºtailçš„nextèŠ‚ç‚¹ï¼Œè®¾ç½®æˆåŠŸä¹‹åï¼Œåœ¨æ›´æ–°tailä¸ºnewNodeèŠ‚ç‚¹ã€‚
- å¦åˆ™ç»§ç»­é‡è¯•ä¸Šä¸€æ­¥
### å‡ºé˜Ÿåˆ—

å‡ºé˜Ÿåˆ—çš„å°±æ˜¯ä»é˜Ÿåˆ—é‡Œè¿”å›ä¸€ä¸ªèŠ‚ç‚¹å…ƒç´ ï¼Œå¹¶æ¸…ç©ºè¯¥èŠ‚ç‚¹å¯¹å…ƒç´ çš„å¼•ç”¨

![](https://user-gold-cdn.xitu.io/2019/12/23/16f3183d1d9144fa?w=671&h=441&f=png&s=108023)

ä»¥ä¸‹æ˜¯å‡ºé˜Ÿåˆ—çš„æºç ï¼š

```
public E poll() {
    restartFromHead:
    for (;;) {
        for (Node<E> h = head, p = h, q;;) {
            E item = p.item;
            if (item != null && casItem(p, item, null)) {
                if (p != h) // hop two nodes at a time
                    updateHead(h, ((q = p.next) != null) ? q : p);
                return item;
            }
            else if ((q = p.next) == null) {
                updateHead(h, p);
                return null;
            }
            else if (p == q)
                continue restartFromHead;
            else
                p = q;
        }
    }
}
```
é¦–å…ˆè·å–headèŠ‚ç‚¹çš„å…ƒç´ itemï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Ÿ
- å¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºå¦å¤–ä¸€ä¸ªçº¿ç¨‹å·²ç»è¿›è¡Œäº†ä¸€æ¬¡å‡ºé˜Ÿæ“ä½œå°†è¯¥èŠ‚ç‚¹çš„å…ƒç´ å–èµ°ã€‚
- å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨CASçš„æ–¹å¼å°†å¤´èŠ‚ç‚¹çš„å¼•ç”¨è®¾ç½®æˆnullï¼Œå¦‚æœCASæˆåŠŸï¼Œåˆ™ç›´æ¥è¿”å›å¤´èŠ‚ç‚¹çš„å…ƒç´ itemï¼Œå¦‚æœä¸æˆåŠŸï¼Œè¡¨ç¤ºå¦å¤–ä¸€ä¸ªçº¿ç¨‹å·²ç»è¿›è¡Œäº†ä¸€æ¬¡å‡ºé˜Ÿæ“ä½œæ›´æ–°äº†headèŠ‚ç‚¹ï¼Œå¯¼è‡´å…ƒç´ å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦é‡æ–°è·å–å¤´èŠ‚ç‚¹ã€‚

## Javaä¸­çš„é˜»å¡é˜Ÿåˆ—
### ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—

é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ï¼š

- æ”¯æŒé˜»å¡çš„æ’å…¥æ–¹æ³•ï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡æ’å…¥å…ƒç´ çš„çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸æ»¡ã€‚
- æ”¯æŒé˜»å¡çš„ç§»é™¤æ–¹æ³•ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚

é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å‘é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œå–å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…ç”¨æ¥å­˜æ”¾å…ƒç´ ã€æ¶ˆè´¹è€…ç”¨æ¥è·å–å…ƒç´ çš„å®¹å™¨

åœ¨é˜»å¡é˜Ÿåˆ—ä¸å¯ç”¨æ—¶ï¼Œè¿™ä¸¤ä¸ªé™„åŠ æ“ä½œæä¾›äº†ä»¥ä¸‹4ç§å¤„ç†æ–¹å¼ï¼š

|æ–¹æ³•/å¤„ç†æ–¹å¼	|æŠ›å‡ºå¼‚å¸¸|	è¿”å›ç‰¹æ®Šå€¼|	ä¸€ç›´é˜»å¡|	è¶…æ—¶é€€å‡º|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|æ’å…¥æ–¹æ³•|add(e)|	offer(e)|	put(e)|	offer(e, time, unit)|
|ç§»é™¤æ–¹æ³•|	remove()|	poll()|	take()|	poll(time, unit)|
|æ£€æŸ¥æ–¹æ³•|	element()|	peek()|ä¸å¯ç”¨|	ä¸å¯ç”¨|

- æŠ›å‡ºå¼‚å¸¸ï¼šé˜Ÿåˆ—æ»¡æ—¶ï¼Œå†æ·»åŠ å…ƒç´ ï¼Œä¼šæŠ›å‡ºIllegalStateException("Queue full")å¼‚å¸¸ï¼›å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ã€‚
- è¿”å›ç‰¹æ®Šå€¼ï¼šå¾€é˜Ÿåˆ—æ’å…¥å…ƒç´ æ—¶ï¼Œè¿”å›tureè¡¨ç¤ºæ’å…¥æˆåŠŸã€‚ä»é˜Ÿåˆ—é‡Œç§»é™¤å…ƒç´ ï¼Œå³å–å‡ºå…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›nullã€‚
- ä¸€ç›´é˜»å¡ï¼šå½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¦‚æœç”Ÿäº§è€…çº¿ç¨‹å¾€é˜Ÿåˆ—é‡Œputå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—å¯ç”¨æˆ–è€…å“åº”ä¸­æ–­é€€å‡ºã€‚å½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œå¦‚æœæ¶ˆè´¹è€…çº¿ç¨‹ä»é˜Ÿåˆ—é‡Œtakeå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ä½æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ä¸ºç©ºã€‚
- è¶…æ—¶é€€å‡ºï¼šå½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¦‚æœç”Ÿäº§è€…çº¿ç¨‹å¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šçš„æ—¶é—´timeï¼Œç”Ÿäº§è€…çº¿ç¨‹å°±ä¼šé€€å‡ºã€‚

> å¦‚æœæ˜¯æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸å¯èƒ½ä¼šå‡ºç°æ»¡çš„æƒ…å†µï¼Œæ‰€ä»¥ä½¿ç”¨putæˆ–offeræ–¹æ³•æ°¸è¿œä¸ä¼šè¢«é˜»å¡ï¼Œè€Œä¸”ä½¿ç”¨offeræ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•æ°¸è¿œè¿”å›trueã€‚

### Javaé‡Œçš„é˜»å¡é˜Ÿåˆ—
- ArrayBlockingQueueï¼šä¸€ä¸ªç”± æ•°ç»„ ç»“æ„ç»„æˆçš„ æœ‰ç•Œ é˜»å¡é˜Ÿåˆ—ã€‚   
æŒ‰ç…§FIFOçš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åº  ã€‚   
é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯çº¿ç¨‹å…¬å¹³çš„è®¿é—®é˜Ÿåˆ—ã€‚    
å…¬å¹³è®¿é—® é˜Ÿåˆ—æ˜¯æŒ‡é˜»å¡çš„çº¿ç¨‹ï¼Œå¯ä»¥ æŒ‰ç…§é˜»å¡çš„å…ˆåé¡ºåºè®¿é—®é˜Ÿåˆ—ï¼Œå³å…ˆé˜»å¡çº¿ç¨‹å…ˆè®¿é—®é˜Ÿåˆ—ã€‚   
éå…¬å¹³æ€§æ˜¯å¯¹å…ˆç­‰å¾…çš„çº¿ç¨‹æ˜¯éå…¬å¹³çš„ï¼Œå½“é˜Ÿåˆ—å¯ç”¨æ—¶ï¼Œé˜»å¡çš„çº¿ç¨‹éƒ½æœ‰äº‰å¤ºè®¿é—®é˜Ÿåˆ—çš„èµ„æ ¼ï¼Œæœ‰å¯èƒ½å…ˆé˜»å¡çš„çº¿ç¨‹æœ€åæ‰è®¿é—®é˜Ÿåˆ—ã€‚

ä¸ºäº†ä¿è¯å…¬å¹³æ€§ï¼Œé€šå¸¸ä¼šé™ä½ååé‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªå…¬å¹³çš„é˜»å¡é˜Ÿåˆ—ï¼š

```
ArrayBlockingQueue fairQueue = new ArrayBlockingQueue(1000,true);

public ArrayBlockingQueue(int capacity, boolean fair) {
    if (capacity <= 0)
        throw new IllegalArgumentException();
    this.items = new Object[capacity];
    lock = new ReentrantLock(fair);
    notEmpty = lock.newCondition();
    notFull =  lock.newCondition();
}
```
- LinkedBlockingQueueï¼šä¸€ä¸ªç”± é“¾è¡¨ ç»“æ„ç»„æˆçš„ æœ‰ç•Œ é˜»å¡é˜Ÿåˆ—ã€‚
æ­¤é˜Ÿåˆ—çš„é»˜è®¤å’Œæœ€å¤§é•¿åº¦ä¸ºInteger.MAX_VALUEã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§FIFOçš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚
- DelayQueueï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„ æ— ç•Œ é˜»å¡é˜Ÿåˆ—ã€‚
DelayQueueæ˜¯ä¸€ä¸ªæ”¯æŒ å»¶æ—¶è·å–å…ƒç´  çš„ æ— ç•Œ é˜»å¡é˜Ÿåˆ—ã€‚
é˜Ÿåˆ—ä½¿ç”¨PriorityQueueæ¥å®ç°ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ ã€‚åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡æ—¶æ‰èƒ½ä»é˜Ÿåˆ—ä¸­æå–å…ƒç´ ã€‚
å¯ä»¥å°†DelayQueueè¿ç”¨åœ¨ä»¥ä¸‹åº”ç”¨åœºæ™¯:
- ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡ï¼šå¯ä»¥ç”¨DelayQueueä¿å­˜ç¼“å­˜å…ƒç´ çš„æœ‰æ•ˆæœŸï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¾ªç¯æŸ¥è¯¢DelayQueueï¼Œä¸€æ—¦èƒ½ä»DelayQueueä¸­è·å–å…ƒç´ æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæœŸåˆ°äº†ã€‚
- å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼šä½¿ç”¨DelayQueueä¿å­˜å½“å¤©å°†ä¼šæ‰§è¡Œçš„ä»»åŠ¡å’Œæ‰§è¡Œæ—¶é—´ï¼Œä¸€æ—¦ä»DelayQueueä¸­è·å–åˆ°ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œï¼Œæ¯”å¦‚TimerQueueå°±æ˜¯ä½¿ç”¨DelayQueueå®ç°çš„ã€‚

- LinkedBlockingDequeï¼šä¸€ä¸ªç”± é“¾è¡¨ ç»“æ„ç»„æˆçš„ åŒå‘ é˜»å¡é˜Ÿåˆ—ã€‚
æ‰€è°“åŒå‘é˜Ÿåˆ—æŒ‡çš„æ˜¯å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œç§»å‡ºå…ƒç´ ã€‚åŒå‘é˜Ÿåˆ—å› ä¸ºå¤šäº†ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—çš„å…¥å£ï¼Œåœ¨å¤šçº¿ç¨‹åŒæ—¶å…¥é˜Ÿæ—¶ï¼Œä¹Ÿå°±å‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚
ç›¸æ¯”å…¶ä»–çš„é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedBlockingDequeå¤šäº†addFirstã€addLastã€offerFirstã€offerLastã€peekFirstå’ŒpeekLastç­‰æ–¹æ³•ã€‚
ä»¥Firstå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ã€è·å–ï¼ˆpeekï¼‰æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„ ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚
ä»¥Lastå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ã€è·å–æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„ æœ€åä¸€ä¸ªå…ƒç´ ã€‚

### é˜»å¡é˜Ÿåˆ—çš„å®ç°åŸç†
å³ä¸ºä½¿ç”¨ é€šçŸ¥æ¨¡å¼ å®ç°ã€‚å°±æ˜¯å½“ç”Ÿäº§è€…å¾€æ»¡çš„é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ æ—¶ä¼šé˜»å¡ä½ç”Ÿäº§è€…ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹äº†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„å…ƒç´ åï¼Œä¼šé€šçŸ¥ç”Ÿäº§è€…å½“å‰é˜Ÿåˆ—å¯ç”¨ã€‚

ä»¥ä¸‹æ˜¯ArrayBlockingQueueçš„ç›¸å…³ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯ç”¨Conditionæ¥å®ç°çš„ï¼š


```
public ArrayBlockingQueue(int capacity, boolean fair) {
    ...
    notEmpty = lock.newCondition();
    notFull =  lock.newCondition();
}
public void put(E e) throws InterruptedException {
    Objects.requireNonNull(e);
    final ReentrantLock lock = this.lock;
    lock.lockInterruptibly();
    try {
        while (count == items.length)
            notFull.await();
        enqueue(e);
    } finally {
        lock.unlock();
    }
}
public E take() throws InterruptedException {
    final ReentrantLock lock = this.lock;
    lock.lockInterruptibly();
    try {
        while (count == 0)
            notEmpty.await();
        return dequeue();
    } finally {
        lock.unlock();
    }
}
private void enqueue(E x) {
    // assert lock.getHoldCount() == 1;
    // assert items[putIndex] == null;
    final Object[] items = this.items;
    items[putIndex] = x;
    if (++putIndex == items.length) putIndex = 0;
    count++;
    notEmpty.signal();
}
private E dequeue() {
    // assert lock.getHoldCount() == 1;
    // assert items[takeIndex] != null;
    final Object[] items = this.items;
    @SuppressWarnings("unchecked")
    E x = (E) items[takeIndex];
    items[takeIndex] = null;
    if (++takeIndex == items.length) takeIndex = 0;
    count--;
    if (itrs != null)
        itrs.elementDequeued();
    notFull.signal();
    return x;
}
```
## Fork / Join æ¡†æ¶
Fork/Joinæ¡†æ¶æ˜¯ Java 7æä¾›çš„ä¸€ä¸ªç”¨äºå¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ª æŠŠå¤§ä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œæœ€ç»ˆæ±‡æ€»æ¯ä¸ªå°ä»»åŠ¡ç»“æœåå¾—åˆ°å¤§ä»»åŠ¡ç»“æœ çš„æ¡†æ¶ã€‚

æ¯”å¦‚è®¡ç®—1+2+â€¦+10000ï¼›å¯ä»¥åˆ†å‰²æˆ10ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡åˆ†åˆ«å¯¹1000ä¸ªæ•°è¿›è¡Œæ±‚å’Œï¼Œæœ€ç»ˆæ±‡æ€»è¿™10ä¸ªå­ä»»åŠ¡çš„ç»“æœã€‚

![](https://user-gold-cdn.xitu.io/2019/12/23/16f31947c19ce65f?w=533&h=699&f=png&s=129315)
å·¥ä½œçªƒå–ç®—æ³•

å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰ç®—æ³•æ˜¯æŒ‡æŸä¸ªçº¿ç¨‹ä»å…¶ä»–é˜Ÿåˆ—é‡Œçªƒå–ä»»åŠ¡æ¥æ‰§è¡Œã€‚
æ¯”å¦‚ æˆ‘ä»¬æŠŠä¸€ä¸ªå¤§ä»»åŠ¡åˆ†æˆ 10 ä¸ªå°ä»»åŠ¡ è®© 10ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¯èƒ½çº¿ç¨‹1æ‰§è¡Œçš„ä»»åŠ¡å¾ˆå¿«å°±å®Œæˆäº†ï¼Œçº¿ç¨‹2 æ‰§è¡Œçš„æ¯”è¾ƒæ…¢ï¼Œè¿™æ—¶å€™çº¿ç¨‹1å°±å¯ä»¥å»çº¿ç¨‹2çš„ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢å»å–ä»»åŠ¡æ¥ç»§ç»­å·¥ä½œï¼Œä»¥æé«˜æ•ˆç‡ã€‚

![](https://user-gold-cdn.xitu.io/2019/12/23/16f319501ce0ce7f?w=587&h=496&f=png&s=89407)

å·¥ä½œçªƒå–ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼š

- ä¼˜ç‚¹ï¼šå……åˆ†åˆ©ç”¨çº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå‡å°‘äº†çº¿ç¨‹é—´çš„ç«äº‰ã€‚
- ç¼ºç‚¹ï¼šåœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯å­˜åœ¨ç«äº‰ï¼Œæ¯”å¦‚åŒç«¯é˜Ÿåˆ—é‡Œåªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶ã€‚å¹¶ä¸”è¯¥ç®—æ³•ä¼šæ¶ˆè€—äº†æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚åˆ›å»ºå¤šä¸ªçº¿ç¨‹å’Œå¤šä¸ªåŒç«¯é˜Ÿåˆ—ã€‚

#### Fork/Joinæ¡†æ¶çš„è®¾è®¡
* åˆ†å‰²ä»»åŠ¡
- æ‰§è¡Œä»»åŠ¡å¹¶åˆå¹¶ç»“æœ

Fork/Joinä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªç±»æ¥å®Œæˆä»¥ä¸Šä¸¤ä»¶äº‹æƒ…ï¼š
- ForkJoinTask
    æˆ‘ä»¬è¦ä½¿ç”¨ForkJoinæ¡†æ¶ï¼Œå¿…é¡»é¦–å…ˆåˆ›å»ºä¸€ä¸ªForkJoinä»»åŠ¡ã€‚  
å®ƒæä¾›åœ¨ä»»åŠ¡ä¸­æ‰§è¡Œ fork()å’Œjoin()æ“ä½œçš„æœºåˆ¶ã€‚      
é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç›´æ¥ç»§æ‰¿ForkJoinTaskç±»ï¼Œåªéœ€è¦ç»§æ‰¿å®ƒçš„å­ç±»ï¼ŒFork/Joinæ¡†æ¶æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªå­ç±»ï¼š  
    - RecursiveAction ï¼šç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚
    - RecursiveTaskï¼šç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚
- ForkJoinPool
    - ForkJoinTaskéœ€è¦é€šè¿‡ForkJoinPoolæ¥æ‰§è¡Œã€‚

ä»»åŠ¡åˆ†å‰²å‡ºçš„å­ä»»åŠ¡ä¼šæ·»åŠ åˆ°å½“å‰å·¥ä½œçº¿ç¨‹æ‰€ç»´æŠ¤çš„åŒç«¯é˜Ÿåˆ—ä¸­ï¼Œè¿›å…¥é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚
å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—é‡Œæš‚æ—¶æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œå®ƒä¼šéšæœºä»å…¶ä»–å·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—çš„å°¾éƒ¨è·å–ä¸€ä¸ªä»»åŠ¡ã€‚
### ä½¿ç”¨Fork/Joinæ¡†æ¶

ä»¥ä¸‹ç¤ºä¾‹ä¸ºä½¿ç”¨Fork/Joinæ¡†æ¶è®¡ç®— 1+2+3+4 ï¼Œè®¾ç½®çš„åˆ†å‰²çš„é˜ˆå€¼æ˜¯2ï¼Œå³1+2+3+4ä¼šè¢«åˆ†å‰²ä¸º1+2 å’Œ 3+4ä¸¤ä¸ªä»»åŠ¡ï¼Œå› ä¸ºæœ‰è¿”å›ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨RecursiceTaskï¼š

```
public class TestRecursiveTask extends RecursiveTask<Integer> {

    /**
     * é˜ˆå€¼
     */
    private static final int THRESHOLD = 2;
    private int start;
    private int end;

    public TestRecursiveTask(int start, int end) {
        this.start = start;
        this.end = end;
    }

    public static void main(String[] args) {
        ForkJoinPool forkJoinPool = new ForkJoinPool();
        // ç”Ÿæˆä¸€ä¸ªè®¡ç®—ä»»åŠ¡ï¼Œè´Ÿè´£è®¡ç®—1+2+3+4
        TestRecursiveTask task = new TestRecursiveTask(1, 4);
        // æ‰§è¡Œä¸€ä¸ªä»»åŠ¡
        Future<Integer> result = forkJoinPool.submit(task);
        try {
            System.out.println(result.get());
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Override
    protected Integer compute() {
        int sum = 0;
        // å¦‚æœä»»åŠ¡è¶³å¤Ÿå°å°±è®¡ç®—ä»»åŠ¡
        boolean canCompute = (end - start) <= THRESHOLD;
        System.out.println(start + "---" + end);
        if (canCompute) {
            for (int i = start; i <= end; i++) {
                sum += i;
            }
        } else {
            // å¦‚æœä»»åŠ¡å¤§äºé˜ˆå€¼ï¼Œå°±åˆ†è£‚æˆä¸¤ä¸ªå­ä»»åŠ¡è®¡ç®—
            int middle = (start + end) / 2;
            TestRecursiveTask leftTask = new TestRecursiveTask(start, middle);
            TestRecursiveTask rightTask = new TestRecursiveTask(middle + 1, end);
            // æ‰§è¡Œå­ä»»åŠ¡
            leftTask.fork();
            rightTask.fork();
            // ç­‰å¾…å­ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå¹¶å¾—åˆ°å…¶ç»“æœ
            int leftResult = leftTask.join();
            int rightResult = rightTask.join();
            // åˆå¹¶å­ä»»åŠ¡
            sum = leftResult + rightResult;
        }
        return sum;
    }
}
//1---4
//1---2
//3---4
//10
```
é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£ForkJoinTaskï¼ŒForkJoinTaskä¸ä¸€èˆ¬ä»»åŠ¡çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒéœ€è¦å®ç°computeæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œé¦–å…ˆéœ€è¦åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¶³å¤Ÿå°ï¼Œå¦‚æœè¶³å¤Ÿå°å°±ç›´æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœä¸è¶³å¤Ÿå°ï¼Œå°±å¿…é¡»åˆ†å‰²æˆä¸¤ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡åœ¨è°ƒç”¨forkæ–¹æ³•æ—¶ï¼Œåˆä¼šè¿›å…¥computeæ–¹æ³•ï¼Œçœ‹çœ‹å½“å‰å­ä»»åŠ¡æ˜¯å¦éœ€è¦ç»§ç»­åˆ†å‰²æˆå­ä»»åŠ¡ï¼Œå¦‚æœä¸éœ€è¦ç»§ç»­åˆ†å‰²ï¼Œåˆ™æ‰§è¡Œå½“å‰å­ä»»åŠ¡å¹¶è¿”å›ç»“æœã€‚ä½¿ç”¨joinæ–¹æ³•ä¼šç­‰å¾…å­ä»»åŠ¡æ‰§è¡Œå®Œå¹¶å¾—åˆ°å…¶ç»“æœã€‚


## ç»“å°¾
å› ä¸ºå¾ˆå¤šä¸œè¥¿ï¼Œå…¨æ˜¯ä»ä¹¦ä¸Šæ‹·è´çš„ï¼Œå¾ˆæ¯ç‡¥ï¼Œä½†åŒæ—¶çœ‹ä¹¦ï¼Œåˆæ˜¯æœ€è¯¦ç»†çš„å­¦ä¹ æ–¹æ³•ä¹‹ä¸€äº†ï¼Œå¤§å®¶è·Ÿç€ä¹¦çœ‹åšå®¢ï¼Œæˆ–è®¸ä¼šå¥½ç‚¹å§.


> å› ä¸ºåšä¸»ä¹Ÿæ˜¯ä¸€ä¸ªå¼€å‘èŒæ–° æˆ‘ä¹Ÿæ˜¯ä¸€è¾¹å­¦ä¸€è¾¹å†™ æˆ‘æœ‰ä¸ªç›®æ ‡å°±æ˜¯ä¸€å‘¨ äºŒåˆ°ä¸‰ç¯‡ å¸Œæœ›èƒ½åšæŒä¸ªä¸€å¹´å§ å¸Œæœ›å„ä½å¤§ä½¬å¤šææ„è§ï¼Œè®©æˆ‘å¤šå­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥ã€‚
## æ—¥å¸¸æ±‚èµ
> å¥½äº†å„ä½ï¼Œä»¥ä¸Šå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œèƒ½çœ‹åˆ°è¿™é‡Œçš„äººå‘€ï¼Œéƒ½æ˜¯**çœŸç²‰**ã€‚

> åˆ›ä½œä¸æ˜“ï¼Œå„ä½çš„æ”¯æŒå’Œè®¤å¯ï¼Œå°±æ˜¯æˆ‘åˆ›ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼Œæˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« è§

>å…­è„‰ç¥å‰‘ | æ–‡ ã€åŸåˆ›ã€‘å¦‚æœæœ¬ç¯‡åšå®¢æœ‰ä»»ä½•é”™è¯¯ï¼Œè¯·æ‰¹è¯„æŒ‡æ•™ï¼Œä¸èƒœæ„Ÿæ¿€ ï¼

